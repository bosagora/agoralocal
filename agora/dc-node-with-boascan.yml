version: '3.3'
services:
    boascan:
        depends_on:
          - smart-contract-verifier
          - redis_db
        image: blockscout/blockscout:${DOCKER_TAG:-latest}
        restart: always
        stop_grace_period: 5m
        container_name: 'boascan'
        command: bash -c "bin/blockscout eval \"Elixir.Explorer.ReleaseTasks.create_and_migrate()\" && bin/blockscout start"
        extra_hosts:
            - 'host.docker.internal:host-gateway'
        env_file:
            - ./config/boascan/common-boascan.env
        environment:
            ETHEREUM_JSONRPC_VARIANT: 'geth'
            ETHEREUM_JSONRPC_HTTP_URL: http://host.docker.internal:8545/
            DATABASE_URL: postgresql://agora:12345678@host.docker.internal:5432/blockscout?ssl=false
            ECTO_USE_SSL: 'false'
            SECRET_KEY_BASE: '56NtB48ear7+wMSf0IQuWDAAazhpb31qyc7GiyspBP2vh7t5zlCsF5QDv76chXeN'
        ports:
            - 14000:14000
        volumes:
            - ./logs/:/app/logs/
        networks:
            default_bridge:
                ipv4_address: 172.21.0.131

    redis_db:
        extends:
            file: ./services/docker-compose-redis.yml
            service: redis_db

    smart-contract-verifier:
        extends:
            file: ./services/docker-compose-smart-contract-verifier.yml
            service: smart-contract-verifier

    visualizer:
        extends:
            file: ./services/docker-compose-visualizer.yml
            service: visualizer

    sig-provider:
        extends:
            file: ./services/docker-compose-sig-provider.yml
            service: sig-provider

networks:
    default_bridge:
        ipam:
            driver: default
            config:
                - subnet: 172.21.0.0/16
