#!/bin/bash

if [[ -z $(docker network ls | grep "bosagora_network") ]]
then
  docker network create --subnet=172.200.0.0/16 bosagora_network
  sleep 2
fi

if [[ -n $(docker-compose ls | grep "agora-chain") ]]
then
  ./agora-chain-ctrl/cmd stop
  sleep 2
fi

if [[ -n $(docker-compose ls | grep "agora-scan ") ]]
then
  ./agora/cmd stop-agora-scan
  sleep 2
fi

if [[ -n $(docker-compose ls | grep "boa-scan") ]]
then
  ./agora/cmd stop-boa-scan
  sleep 2
fi

if [[ -n $(docker-compose ls | grep "postgres") ]]
then
  ./agora/cmd stop-db
  sleep 2
fi

if [[ -n $(docker-compose ls | grep "nodes-bellatrix\|nodes-capella") ]]
then
  ./agora/cmd stop
  sleep 2
fi

./agora/cmd start-db
sleep 5

./agora/cmd init-db
sleep 5

./agora/cmd init

./agora/cmd start

sleep 5

npm run deploy:commons_budeget
npm run deploy:deposit
npm run staking

./agora/cmd start-agora-scan

sleep 5

while true; do
  case "$1" in
    -b|--boascan)
      ./agora/cmd start-boa-scan
      break;;
     *)
      break;;
  esac
done
